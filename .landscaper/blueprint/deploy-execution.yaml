deployItems:
  - name: landscaper-service
    type: landscaper.gardener.cloud/helm
    target:
      name: {{ .imports.targetCluster.metadata.name }}
      namespace: {{ .imports.targetCluster.metadata.namespace }}
    config:
      apiVersion: helm.deployer.landscaper.gardener.cloud/v1alpha1
      kind: ProviderConfiguration
      updateStrategy: patch
      name: landscaper-service
      namespace: {{ .imports.namespace }}

      chart:
        {{ $resource := getResource .cd "name" "landscaper-service-chart" }}
        ref: {{ $resource.access.imageReference }}

      values:
        {{ $controllerImgResource := getResource .cd "name" "landscaper-service-controller" }}
        {{ $controllerImgRepo := ociRefRepo $controllerImgResource.access.imageReference }}
        {{ $controllerImgTag := ociRefVersion $controllerImgResource.access.imageReference }}

        {{ $webhooksImgResource := getResource .cd "name" "landscaper-service-webhooks-server" }}
        {{ $webhooksImgRepo := ociRefRepo $webhooksImgResource.access.imageReference }}
        {{ $webhooksImgTag := ociRefVersion $webhooksImgResource.access.imageReference }}

        controller:
          image:
            repository: {{ $controllerImgRepo }}
            tag: {{ $controllerImgTag }}
            pullPolicy: IfNotPresent

        webhooksServer:
          image:
            repository: {{ $webhooksImgRepo }}
            tag: {{ $webhooksImgTag }}
            pullPolicy: IfNotPresent

        landscaperservice:
          verbosity: {{ .imports.verbosity | default 2 }}

          crdManagement:
            deployCrd: true
            forceUpdate: true

        serviceAccount:
          controller:
            create: true
            annotations: {}
            name: ""
          webhooksServer:
            create: true
            annotations: {}
            name: ""
